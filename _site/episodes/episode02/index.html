<!doctype html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"><!--<![endif]-->
<html>
<head>
<meta charset="utf-8">


<title>Episode 2 - Non-Public Buckets Can Still Leak Information &mdash; Head in the Clouds</title>
<meta name="description" content="2 - Non-Public Buckets Can Still Leak Information



Welcome to Episode 2 of the “Head in the Clouds” Video Series.

Today, I want to talk about AWS S3 Buckets.

We have all read the horror stories about misconfigured Amazon S3 Buckets that expose
millions of customer records and other sensitive information. Something that you may
not know is that a bucket that is not public can still expose sensitive information.

How? Via the name of the bucket.

I once had a client that had created a bucket for everyone of their customers and
thereby leaked their customer list. Granted, this is not the most serious issue in
the cloud, but let’s take a look and you may learn more about AWS S3 in the process.

Imagine, for a moment, we are a company called “ACME Manufacturing.” I always like to
use ACME from the Road Runner cartoons that played on Saturday morning television when
I was a kid.

Let’s also imagine that we plan to create a bucket for each of our customers. And, let’s
say that Walmart is our first customer. So, let’s make a bucket for Walmart:

$ aws s3 mb s3://acme-customers-walmart
make_bucket: acme-customers-walmart


Now upload some sensitive information to the bucket:

$ echo "Juicy Sensitive Data" &gt; customerData.txt
$ aws s3 cp  customerData.txt s3://acme-customers-walmart/customerData.txt
upload: ./customerData.txt to s3://acme-customers-walmart/customerData.txt


In the AWS Web Console, we can see that the URL do our data is:
https://acme-customers-walmart.s3.amazonaws.com/customerData.txt



Next attempt to open the link in a new browser window. I like to use Incognito mode in
Chrome so that I am sure that there is no session data in memory to authenticate me to
the AWS endpoint.

We should get an XML message stating that access is denied:



Ok, that is expected. It is not a public bucket after all. Let’s change the name of the
file we are trying to fetch to “customerData2.txt”



Still Denied. Ok, lets play at the bucket level, by removing the file name from the URL:



Access denied, as expected. One more experiment. Try a non-existent bucket, such as
“acme-customers-kmart”



Interesting. Now we are getting a different error message.

This is a variation of a user account enumeration attack. (For more information,
see http://bit.ly/OWASP-4-03-04)

Because we can get different error messages, we now might have a means to enumerate the
buckets for customer names.

Rather than using a browser, let’s use curl:

curl -i https://acme-customers-walmart.s3.amazonaws.com/
curl -i https://acme-customers-kmart.s3.amazonaws.com/




Note that the HTTP response codes are also different.

We can tweak our command to just return the HTTP Response code:

curl -I -s  https://acme-customers-walmart.s3.amazonaws.com/ | grep HTTP




We can even parameterize the customer name and create a FOR loop:

for NAME in kmart walgreens walmart aldi
do
    RESPONSE=$(curl -I -s  https://acme-customers-$NAME.s3.amazonaws.com/ | grep HTTP)
    echo $NAME": "$RESPONSE
done




Interesting! We can see the expected response codes for Kmart and Walmart. But it
looks like ACME made their Walgreens bucket public!!

What is going on with the acme-customers-aldi bucket?

Let’s run the curl command again and fetch the complete response:

curl -i https://acme-customers-aldi.s3.amazonaws.com/




That is nice of Amazon. Not only do we know that the bucket exists, but that it is hosted in the Frankfurt, Germany region (eu-central-1) because it uses the S3 endpoint at s3.eu-central-1.amazonaws.com rather than Northern Virginia, which uses s3.amazonaws.com. More potentially useful recon info.

Acknowledgements

Today’s topic builds upon the work of Robin Woods (“DigiNija”) and his Bucket Finder tool. There have been other bucket scanning tools, but for today’s topic, I wanted to make sure people understand how these tools work under the covers.

Important Take-Aways

  It is generally unwise to have guessable bucket names. For example, a bucket name of acme-customers-walmart-282901034857378292 would be better, as long as the numerical string appended to the end is random and not something like your AWS account number.
  It would be better to avoid using meaningful words and names such as “ACME”, “Walmart” or even “customers” for bucket names. Remember that you can always use tags and tags are not exposed via DNS. Nothing wrong with a bucket named “cx2821023238238” assuming it is unique.
  If you want to have meaningful names and phrases, do that at the folder level inside a bucket as folders are not exposed by default (like bucket names are).
  Lastly, remember that just because there is a bucket name that contains the name of a well-known company, doesn’t mean that that bucket is controlled by that company. In the examples used in today’s talk, I created buckets for a couple of top retailers even though I have no affiliation with them.


Wrap Up

And that is it for today’s episode.

If you have thoughts or comments on today’s episode, feel free to chime in on our moderated Google Group by shooting a note to head-in-the-clouds-security@googlegroups.com.

Tune in next time for another installment of “Head in the Clouds.” Announcements of new episodes are made on the SANS Cloud Security Twitter feed.

Meanwhile, be sure to check out the other great videos on the SANS Cloud Security YouTube Channel.
">
<meta name="keywords" content="">


<!-- Twitter Cards -->
<meta name="twitter:title" content="Episode 2 - Non-Public Buckets Can Still Leak Information">
<meta name="twitter:description" content="2 - Non-Public Buckets Can Still Leak Information



Welcome to Episode 2 of the “Head in the Clouds” Video Series.

Today, I want to talk about AWS S3 Buckets.

We have all read the horror stories about misconfigured Amazon S3 Buckets that expose
millions of customer records and other sensitive information. Something that you may
not know is that a bucket that is not public can still expose sensitive information.

How? Via the name of the bucket.

I once had a client that had created a bucket for everyone of their customers and
thereby leaked their customer list. Granted, this is not the most serious issue in
the cloud, but let’s take a look and you may learn more about AWS S3 in the process.

Imagine, for a moment, we are a company called “ACME Manufacturing.” I always like to
use ACME from the Road Runner cartoons that played on Saturday morning television when
I was a kid.

Let’s also imagine that we plan to create a bucket for each of our customers. And, let’s
say that Walmart is our first customer. So, let’s make a bucket for Walmart:

$ aws s3 mb s3://acme-customers-walmart
make_bucket: acme-customers-walmart


Now upload some sensitive information to the bucket:

$ echo "Juicy Sensitive Data" &gt; customerData.txt
$ aws s3 cp  customerData.txt s3://acme-customers-walmart/customerData.txt
upload: ./customerData.txt to s3://acme-customers-walmart/customerData.txt


In the AWS Web Console, we can see that the URL do our data is:
https://acme-customers-walmart.s3.amazonaws.com/customerData.txt



Next attempt to open the link in a new browser window. I like to use Incognito mode in
Chrome so that I am sure that there is no session data in memory to authenticate me to
the AWS endpoint.

We should get an XML message stating that access is denied:



Ok, that is expected. It is not a public bucket after all. Let’s change the name of the
file we are trying to fetch to “customerData2.txt”



Still Denied. Ok, lets play at the bucket level, by removing the file name from the URL:



Access denied, as expected. One more experiment. Try a non-existent bucket, such as
“acme-customers-kmart”



Interesting. Now we are getting a different error message.

This is a variation of a user account enumeration attack. (For more information,
see http://bit.ly/OWASP-4-03-04)

Because we can get different error messages, we now might have a means to enumerate the
buckets for customer names.

Rather than using a browser, let’s use curl:

curl -i https://acme-customers-walmart.s3.amazonaws.com/
curl -i https://acme-customers-kmart.s3.amazonaws.com/




Note that the HTTP response codes are also different.

We can tweak our command to just return the HTTP Response code:

curl -I -s  https://acme-customers-walmart.s3.amazonaws.com/ | grep HTTP




We can even parameterize the customer name and create a FOR loop:

for NAME in kmart walgreens walmart aldi
do
    RESPONSE=$(curl -I -s  https://acme-customers-$NAME.s3.amazonaws.com/ | grep HTTP)
    echo $NAME": "$RESPONSE
done




Interesting! We can see the expected response codes for Kmart and Walmart. But it
looks like ACME made their Walgreens bucket public!!

What is going on with the acme-customers-aldi bucket?

Let’s run the curl command again and fetch the complete response:

curl -i https://acme-customers-aldi.s3.amazonaws.com/




That is nice of Amazon. Not only do we know that the bucket exists, but that it is hosted in the Frankfurt, Germany region (eu-central-1) because it uses the S3 endpoint at s3.eu-central-1.amazonaws.com rather than Northern Virginia, which uses s3.amazonaws.com. More potentially useful recon info.

Acknowledgements

Today’s topic builds upon the work of Robin Woods (“DigiNija”) and his Bucket Finder tool. There have been other bucket scanning tools, but for today’s topic, I wanted to make sure people understand how these tools work under the covers.

Important Take-Aways

  It is generally unwise to have guessable bucket names. For example, a bucket name of acme-customers-walmart-282901034857378292 would be better, as long as the numerical string appended to the end is random and not something like your AWS account number.
  It would be better to avoid using meaningful words and names such as “ACME”, “Walmart” or even “customers” for bucket names. Remember that you can always use tags and tags are not exposed via DNS. Nothing wrong with a bucket named “cx2821023238238” assuming it is unique.
  If you want to have meaningful names and phrases, do that at the folder level inside a bucket as folders are not exposed by default (like bucket names are).
  Lastly, remember that just because there is a bucket name that contains the name of a well-known company, doesn’t mean that that bucket is controlled by that company. In the examples used in today’s talk, I created buckets for a couple of top retailers even though I have no affiliation with them.


Wrap Up

And that is it for today’s episode.

If you have thoughts or comments on today’s episode, feel free to chime in on our moderated Google Group by shooting a note to head-in-the-clouds-security@googlegroups.com.

Tune in next time for another installment of “Head in the Clouds.” Announcements of new episodes are made on the SANS Cloud Security Twitter feed.

Meanwhile, be sure to check out the other great videos on the SANS Cloud Security YouTube Channel.
">
<meta name="twitter:site" content="@kennethghartman">
<meta name="twitter:creator" content="@kennethghartman">

<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="/images/default-thumb.png">

<!-- Open Graph -->
<meta property="og:locale" content="en_US">
<meta property="og:type" content="article">
<meta property="og:title" content="Episode 2 - Non-Public Buckets Can Still Leak Information">
<meta property="og:description" content="2 - Non-Public Buckets Can Still Leak Information



Welcome to Episode 2 of the “Head in the Clouds” Video Series.

Today, I want to talk about AWS S3 Buckets.

We have all read the horror stories about misconfigured Amazon S3 Buckets that expose
millions of customer records and other sensitive information. Something that you may
not know is that a bucket that is not public can still expose sensitive information.

How? Via the name of the bucket.

I once had a client that had created a bucket for everyone of their customers and
thereby leaked their customer list. Granted, this is not the most serious issue in
the cloud, but let’s take a look and you may learn more about AWS S3 in the process.

Imagine, for a moment, we are a company called “ACME Manufacturing.” I always like to
use ACME from the Road Runner cartoons that played on Saturday morning television when
I was a kid.

Let’s also imagine that we plan to create a bucket for each of our customers. And, let’s
say that Walmart is our first customer. So, let’s make a bucket for Walmart:

$ aws s3 mb s3://acme-customers-walmart
make_bucket: acme-customers-walmart


Now upload some sensitive information to the bucket:

$ echo "Juicy Sensitive Data" &gt; customerData.txt
$ aws s3 cp  customerData.txt s3://acme-customers-walmart/customerData.txt
upload: ./customerData.txt to s3://acme-customers-walmart/customerData.txt


In the AWS Web Console, we can see that the URL do our data is:
https://acme-customers-walmart.s3.amazonaws.com/customerData.txt



Next attempt to open the link in a new browser window. I like to use Incognito mode in
Chrome so that I am sure that there is no session data in memory to authenticate me to
the AWS endpoint.

We should get an XML message stating that access is denied:



Ok, that is expected. It is not a public bucket after all. Let’s change the name of the
file we are trying to fetch to “customerData2.txt”



Still Denied. Ok, lets play at the bucket level, by removing the file name from the URL:



Access denied, as expected. One more experiment. Try a non-existent bucket, such as
“acme-customers-kmart”



Interesting. Now we are getting a different error message.

This is a variation of a user account enumeration attack. (For more information,
see http://bit.ly/OWASP-4-03-04)

Because we can get different error messages, we now might have a means to enumerate the
buckets for customer names.

Rather than using a browser, let’s use curl:

curl -i https://acme-customers-walmart.s3.amazonaws.com/
curl -i https://acme-customers-kmart.s3.amazonaws.com/




Note that the HTTP response codes are also different.

We can tweak our command to just return the HTTP Response code:

curl -I -s  https://acme-customers-walmart.s3.amazonaws.com/ | grep HTTP




We can even parameterize the customer name and create a FOR loop:

for NAME in kmart walgreens walmart aldi
do
    RESPONSE=$(curl -I -s  https://acme-customers-$NAME.s3.amazonaws.com/ | grep HTTP)
    echo $NAME": "$RESPONSE
done




Interesting! We can see the expected response codes for Kmart and Walmart. But it
looks like ACME made their Walgreens bucket public!!

What is going on with the acme-customers-aldi bucket?

Let’s run the curl command again and fetch the complete response:

curl -i https://acme-customers-aldi.s3.amazonaws.com/




That is nice of Amazon. Not only do we know that the bucket exists, but that it is hosted in the Frankfurt, Germany region (eu-central-1) because it uses the S3 endpoint at s3.eu-central-1.amazonaws.com rather than Northern Virginia, which uses s3.amazonaws.com. More potentially useful recon info.

Acknowledgements

Today’s topic builds upon the work of Robin Woods (“DigiNija”) and his Bucket Finder tool. There have been other bucket scanning tools, but for today’s topic, I wanted to make sure people understand how these tools work under the covers.

Important Take-Aways

  It is generally unwise to have guessable bucket names. For example, a bucket name of acme-customers-walmart-282901034857378292 would be better, as long as the numerical string appended to the end is random and not something like your AWS account number.
  It would be better to avoid using meaningful words and names such as “ACME”, “Walmart” or even “customers” for bucket names. Remember that you can always use tags and tags are not exposed via DNS. Nothing wrong with a bucket named “cx2821023238238” assuming it is unique.
  If you want to have meaningful names and phrases, do that at the folder level inside a bucket as folders are not exposed by default (like bucket names are).
  Lastly, remember that just because there is a bucket name that contains the name of a well-known company, doesn’t mean that that bucket is controlled by that company. In the examples used in today’s talk, I created buckets for a couple of top retailers even though I have no affiliation with them.


Wrap Up

And that is it for today’s episode.

If you have thoughts or comments on today’s episode, feel free to chime in on our moderated Google Group by shooting a note to head-in-the-clouds-security@googlegroups.com.

Tune in next time for another installment of “Head in the Clouds.” Announcements of new episodes are made on the SANS Cloud Security Twitter feed.

Meanwhile, be sure to check out the other great videos on the SANS Cloud Security YouTube Channel.
">
<meta property="og:url" content="/episodes/episode02/">
<meta property="og:site_name" content="Head in the Clouds">

<meta property="og:image" content="/images/default-thumb.png">






<link rel="canonical" href="/episodes/episode02/">
<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Head in the Clouds Feed">

<!-- https://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">


<meta http-equiv="cleartype" content="on">


<!-- Modernizr -->
<script src="/assets/js/vendor/modernizr-2.7.1.custom.min.js"></script>


<link href='//fonts.googleapis.com/css?family=PT+Sans+Narrow:400,700%7CPT+Serif:400,700,400italic' rel='stylesheet' type='text/css'>
<link rel="stylesheet" href="/assets/css/academicons/css/academicons.css"/>
<!-- Icons -->
<!-- 16x16 -->
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" content="#ffffff">

<!--Jekyll-seo plugin-->
<!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Episode 2 - Non-Public Buckets Can Still Leak Information | Head in the Clouds</title>
<meta name="generator" content="Jekyll v4.2.2" />
<meta property="og:title" content="Episode 2 - Non-Public Buckets Can Still Leak Information" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="2 - Non-Public Buckets Can Still Leak Information Welcome to Episode 2 of the “Head in the Clouds” Video Series. Today, I want to talk about AWS S3 Buckets. We have all read the horror stories about misconfigured Amazon S3 Buckets that expose millions of customer records and other sensitive information. Something that you may not know is that a bucket that is not public can still expose sensitive information. How? Via the name of the bucket. I once had a client that had created a bucket for everyone of their customers and thereby leaked their customer list. Granted, this is not the most serious issue in the cloud, but let’s take a look and you may learn more about AWS S3 in the process. Imagine, for a moment, we are a company called “ACME Manufacturing.” I always like to use ACME from the Road Runner cartoons that played on Saturday morning television when I was a kid. Let’s also imagine that we plan to create a bucket for each of our customers. And, let’s say that Walmart is our first customer. So, let’s make a bucket for Walmart: $ aws s3 mb s3://acme-customers-walmart make_bucket: acme-customers-walmart Now upload some sensitive information to the bucket: $ echo &quot;Juicy Sensitive Data&quot; &gt; customerData.txt $ aws s3 cp customerData.txt s3://acme-customers-walmart/customerData.txt upload: ./customerData.txt to s3://acme-customers-walmart/customerData.txt In the AWS Web Console, we can see that the URL do our data is: https://acme-customers-walmart.s3.amazonaws.com/customerData.txt Next attempt to open the link in a new browser window. I like to use Incognito mode in Chrome so that I am sure that there is no session data in memory to authenticate me to the AWS endpoint. We should get an XML message stating that access is denied: Ok, that is expected. It is not a public bucket after all. Let’s change the name of the file we are trying to fetch to “customerData2.txt” Still Denied. Ok, lets play at the bucket level, by removing the file name from the URL: Access denied, as expected. One more experiment. Try a non-existent bucket, such as “acme-customers-kmart” Interesting. Now we are getting a different error message. This is a variation of a user account enumeration attack. (For more information, see http://bit.ly/OWASP-4-03-04) Because we can get different error messages, we now might have a means to enumerate the buckets for customer names. Rather than using a browser, let’s use curl: curl -i https://acme-customers-walmart.s3.amazonaws.com/ curl -i https://acme-customers-kmart.s3.amazonaws.com/ Note that the HTTP response codes are also different. We can tweak our command to just return the HTTP Response code: curl -I -s https://acme-customers-walmart.s3.amazonaws.com/ | grep HTTP We can even parameterize the customer name and create a FOR loop: for NAME in kmart walgreens walmart aldi do RESPONSE=$(curl -I -s https://acme-customers-$NAME.s3.amazonaws.com/ | grep HTTP) echo $NAME&quot;: &quot;$RESPONSE done Interesting! We can see the expected response codes for Kmart and Walmart. But it looks like ACME made their Walgreens bucket public!! What is going on with the acme-customers-aldi bucket? Let’s run the curl command again and fetch the complete response: curl -i https://acme-customers-aldi.s3.amazonaws.com/ That is nice of Amazon. Not only do we know that the bucket exists, but that it is hosted in the Frankfurt, Germany region (eu-central-1) because it uses the S3 endpoint at s3.eu-central-1.amazonaws.com rather than Northern Virginia, which uses s3.amazonaws.com. More potentially useful recon info. Acknowledgements Today’s topic builds upon the work of Robin Woods (“DigiNija”) and his Bucket Finder tool. There have been other bucket scanning tools, but for today’s topic, I wanted to make sure people understand how these tools work under the covers. Important Take-Aways It is generally unwise to have guessable bucket names. For example, a bucket name of acme-customers-walmart-282901034857378292 would be better, as long as the numerical string appended to the end is random and not something like your AWS account number. It would be better to avoid using meaningful words and names such as “ACME”, “Walmart” or even “customers” for bucket names. Remember that you can always use tags and tags are not exposed via DNS. Nothing wrong with a bucket named “cx2821023238238” assuming it is unique. If you want to have meaningful names and phrases, do that at the folder level inside a bucket as folders are not exposed by default (like bucket names are). Lastly, remember that just because there is a bucket name that contains the name of a well-known company, doesn’t mean that that bucket is controlled by that company. In the examples used in today’s talk, I created buckets for a couple of top retailers even though I have no affiliation with them. Wrap Up And that is it for today’s episode. If you have thoughts or comments on today’s episode, feel free to chime in on our moderated Google Group by shooting a note to head-in-the-clouds-security@googlegroups.com. Tune in next time for another installment of “Head in the Clouds.” Announcements of new episodes are made on the SANS Cloud Security Twitter feed. Meanwhile, be sure to check out the other great videos on the SANS Cloud Security YouTube Channel." />
<meta property="og:description" content="2 - Non-Public Buckets Can Still Leak Information Welcome to Episode 2 of the “Head in the Clouds” Video Series. Today, I want to talk about AWS S3 Buckets. We have all read the horror stories about misconfigured Amazon S3 Buckets that expose millions of customer records and other sensitive information. Something that you may not know is that a bucket that is not public can still expose sensitive information. How? Via the name of the bucket. I once had a client that had created a bucket for everyone of their customers and thereby leaked their customer list. Granted, this is not the most serious issue in the cloud, but let’s take a look and you may learn more about AWS S3 in the process. Imagine, for a moment, we are a company called “ACME Manufacturing.” I always like to use ACME from the Road Runner cartoons that played on Saturday morning television when I was a kid. Let’s also imagine that we plan to create a bucket for each of our customers. And, let’s say that Walmart is our first customer. So, let’s make a bucket for Walmart: $ aws s3 mb s3://acme-customers-walmart make_bucket: acme-customers-walmart Now upload some sensitive information to the bucket: $ echo &quot;Juicy Sensitive Data&quot; &gt; customerData.txt $ aws s3 cp customerData.txt s3://acme-customers-walmart/customerData.txt upload: ./customerData.txt to s3://acme-customers-walmart/customerData.txt In the AWS Web Console, we can see that the URL do our data is: https://acme-customers-walmart.s3.amazonaws.com/customerData.txt Next attempt to open the link in a new browser window. I like to use Incognito mode in Chrome so that I am sure that there is no session data in memory to authenticate me to the AWS endpoint. We should get an XML message stating that access is denied: Ok, that is expected. It is not a public bucket after all. Let’s change the name of the file we are trying to fetch to “customerData2.txt” Still Denied. Ok, lets play at the bucket level, by removing the file name from the URL: Access denied, as expected. One more experiment. Try a non-existent bucket, such as “acme-customers-kmart” Interesting. Now we are getting a different error message. This is a variation of a user account enumeration attack. (For more information, see http://bit.ly/OWASP-4-03-04) Because we can get different error messages, we now might have a means to enumerate the buckets for customer names. Rather than using a browser, let’s use curl: curl -i https://acme-customers-walmart.s3.amazonaws.com/ curl -i https://acme-customers-kmart.s3.amazonaws.com/ Note that the HTTP response codes are also different. We can tweak our command to just return the HTTP Response code: curl -I -s https://acme-customers-walmart.s3.amazonaws.com/ | grep HTTP We can even parameterize the customer name and create a FOR loop: for NAME in kmart walgreens walmart aldi do RESPONSE=$(curl -I -s https://acme-customers-$NAME.s3.amazonaws.com/ | grep HTTP) echo $NAME&quot;: &quot;$RESPONSE done Interesting! We can see the expected response codes for Kmart and Walmart. But it looks like ACME made their Walgreens bucket public!! What is going on with the acme-customers-aldi bucket? Let’s run the curl command again and fetch the complete response: curl -i https://acme-customers-aldi.s3.amazonaws.com/ That is nice of Amazon. Not only do we know that the bucket exists, but that it is hosted in the Frankfurt, Germany region (eu-central-1) because it uses the S3 endpoint at s3.eu-central-1.amazonaws.com rather than Northern Virginia, which uses s3.amazonaws.com. More potentially useful recon info. Acknowledgements Today’s topic builds upon the work of Robin Woods (“DigiNija”) and his Bucket Finder tool. There have been other bucket scanning tools, but for today’s topic, I wanted to make sure people understand how these tools work under the covers. Important Take-Aways It is generally unwise to have guessable bucket names. For example, a bucket name of acme-customers-walmart-282901034857378292 would be better, as long as the numerical string appended to the end is random and not something like your AWS account number. It would be better to avoid using meaningful words and names such as “ACME”, “Walmart” or even “customers” for bucket names. Remember that you can always use tags and tags are not exposed via DNS. Nothing wrong with a bucket named “cx2821023238238” assuming it is unique. If you want to have meaningful names and phrases, do that at the folder level inside a bucket as folders are not exposed by default (like bucket names are). Lastly, remember that just because there is a bucket name that contains the name of a well-known company, doesn’t mean that that bucket is controlled by that company. In the examples used in today’s talk, I created buckets for a couple of top retailers even though I have no affiliation with them. Wrap Up And that is it for today’s episode. If you have thoughts or comments on today’s episode, feel free to chime in on our moderated Google Group by shooting a note to head-in-the-clouds-security@googlegroups.com. Tune in next time for another installment of “Head in the Clouds.” Announcements of new episodes are made on the SANS Cloud Security Twitter feed. Meanwhile, be sure to check out the other great videos on the SANS Cloud Security YouTube Channel." />
<link rel="canonical" href="http://localhost:4000/episodes/episode02/" />
<meta property="og:url" content="http://localhost:4000/episodes/episode02/" />
<meta property="og:site_name" content="Head in the Clouds" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2022-05-24T15:17:05-03:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Episode 2 - Non-Public Buckets Can Still Leak Information" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2022-05-24T14:59:38-03:00","datePublished":"2022-05-24T15:17:05-03:00","description":"2 - Non-Public Buckets Can Still Leak Information Welcome to Episode 2 of the “Head in the Clouds” Video Series. Today, I want to talk about AWS S3 Buckets. We have all read the horror stories about misconfigured Amazon S3 Buckets that expose millions of customer records and other sensitive information. Something that you may not know is that a bucket that is not public can still expose sensitive information. How? Via the name of the bucket. I once had a client that had created a bucket for everyone of their customers and thereby leaked their customer list. Granted, this is not the most serious issue in the cloud, but let’s take a look and you may learn more about AWS S3 in the process. Imagine, for a moment, we are a company called “ACME Manufacturing.” I always like to use ACME from the Road Runner cartoons that played on Saturday morning television when I was a kid. Let’s also imagine that we plan to create a bucket for each of our customers. And, let’s say that Walmart is our first customer. So, let’s make a bucket for Walmart: $ aws s3 mb s3://acme-customers-walmart make_bucket: acme-customers-walmart Now upload some sensitive information to the bucket: $ echo &quot;Juicy Sensitive Data&quot; &gt; customerData.txt $ aws s3 cp customerData.txt s3://acme-customers-walmart/customerData.txt upload: ./customerData.txt to s3://acme-customers-walmart/customerData.txt In the AWS Web Console, we can see that the URL do our data is: https://acme-customers-walmart.s3.amazonaws.com/customerData.txt Next attempt to open the link in a new browser window. I like to use Incognito mode in Chrome so that I am sure that there is no session data in memory to authenticate me to the AWS endpoint. We should get an XML message stating that access is denied: Ok, that is expected. It is not a public bucket after all. Let’s change the name of the file we are trying to fetch to “customerData2.txt” Still Denied. Ok, lets play at the bucket level, by removing the file name from the URL: Access denied, as expected. One more experiment. Try a non-existent bucket, such as “acme-customers-kmart” Interesting. Now we are getting a different error message. This is a variation of a user account enumeration attack. (For more information, see http://bit.ly/OWASP-4-03-04) Because we can get different error messages, we now might have a means to enumerate the buckets for customer names. Rather than using a browser, let’s use curl: curl -i https://acme-customers-walmart.s3.amazonaws.com/ curl -i https://acme-customers-kmart.s3.amazonaws.com/ Note that the HTTP response codes are also different. We can tweak our command to just return the HTTP Response code: curl -I -s https://acme-customers-walmart.s3.amazonaws.com/ | grep HTTP We can even parameterize the customer name and create a FOR loop: for NAME in kmart walgreens walmart aldi do RESPONSE=$(curl -I -s https://acme-customers-$NAME.s3.amazonaws.com/ | grep HTTP) echo $NAME&quot;: &quot;$RESPONSE done Interesting! We can see the expected response codes for Kmart and Walmart. But it looks like ACME made their Walgreens bucket public!! What is going on with the acme-customers-aldi bucket? Let’s run the curl command again and fetch the complete response: curl -i https://acme-customers-aldi.s3.amazonaws.com/ That is nice of Amazon. Not only do we know that the bucket exists, but that it is hosted in the Frankfurt, Germany region (eu-central-1) because it uses the S3 endpoint at s3.eu-central-1.amazonaws.com rather than Northern Virginia, which uses s3.amazonaws.com. More potentially useful recon info. Acknowledgements Today’s topic builds upon the work of Robin Woods (“DigiNija”) and his Bucket Finder tool. There have been other bucket scanning tools, but for today’s topic, I wanted to make sure people understand how these tools work under the covers. Important Take-Aways It is generally unwise to have guessable bucket names. For example, a bucket name of acme-customers-walmart-282901034857378292 would be better, as long as the numerical string appended to the end is random and not something like your AWS account number. It would be better to avoid using meaningful words and names such as “ACME”, “Walmart” or even “customers” for bucket names. Remember that you can always use tags and tags are not exposed via DNS. Nothing wrong with a bucket named “cx2821023238238” assuming it is unique. If you want to have meaningful names and phrases, do that at the folder level inside a bucket as folders are not exposed by default (like bucket names are). Lastly, remember that just because there is a bucket name that contains the name of a well-known company, doesn’t mean that that bucket is controlled by that company. In the examples used in today’s talk, I created buckets for a couple of top retailers even though I have no affiliation with them. Wrap Up And that is it for today’s episode. If you have thoughts or comments on today’s episode, feel free to chime in on our moderated Google Group by shooting a note to head-in-the-clouds-security@googlegroups.com. Tune in next time for another installment of “Head in the Clouds.” Announcements of new episodes are made on the SANS Cloud Security Twitter feed. Meanwhile, be sure to check out the other great videos on the SANS Cloud Security YouTube Channel.","headline":"Episode 2 - Non-Public Buckets Can Still Leak Information","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/episodes/episode02/"},"url":"http://localhost:4000/episodes/episode02/"}</script>
<!-- End Jekyll SEO tag -->


<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-K6EX94SG73"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-K6EX94SG73');
</script>


</head>

<body class="page">

<!--[if lt IE 9]><div class="browser-upgrade alert alert-info">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div><![endif]-->

<div class="navigation-wrapper">
	<div class="site-name">
		
		<a href="/">Head in the Clouds</a>
		
	</div><!-- /.site-name -->
	<div class="top-navigation">
		<nav role="navigation" id="site-nav" class="nav">
		    <ul>
		        
				    
				    <li><a href="/" >Home</a></li>
				
				    
				    <li><a href="/episodes/" >All Episodes</a></li>
				
				    
				    <li><a href="https://www.sans.org/cyber-security-courses/?focus-area=cloud-security" target="_blank">SANS CyberSec Courses & Certs</a></li>
				
		    </ul>
		</nav>
	</div><!-- /.top-navigation -->
</div><!-- /.navigation-wrapper -->




<div id="main" role="main">
  <div class="article-author-side">
    

<div itemscope itemtype="https://schema.org/Person">


	<img src="/images/Cloud_Ace_Final.png" class="bio-photo" alt="Head in the Clouds bio photo">


  <h3 itemprop="name">Head in the Clouds</h3>
  <p>with Kenneth G. Hartman<p>Certified SANS Instructor</p>
  <a href="mailto:kgh@kennethghartman.com" class="author-social" target="_blank"><i class="fa fa-fw fa-envelope-square"></i> Email</a>
  <a href="https://twitter.com/kennethghartman" class="author-social" target="_blank"><i class="fa fa-fw fa-twitter-square"></i> Twitter</a>
  
  
  
  
  
  
  
  <a href="https://github.com/Resistor52" class="author-social" target="_blank"><i class="fa fa-fw fa-github"></i> GitHub</a>
  
  
  
  
  
  
  
  
  
  
  
  
  
  
</div>

  </div>
  <article class="page">
    <h1>Episode 2 - Non-Public Buckets Can Still Leak Information</h1>
    <div class="article-wrap">
      <p>2 - Non-Public Buckets Can Still Leak Information</p>

<div class="video-container"><iframe src="https://www.youtube.com/embed/qJzwwC-aZfs" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></div>

<p>Welcome to Episode 2 of the “Head in the Clouds” Video Series.</p>

<p>Today, I want to talk about AWS S3 Buckets.</p>

<p>We have all read the horror stories about misconfigured Amazon S3 Buckets that expose
millions of customer records and other sensitive information. Something that you may
not know is that a bucket that is not public can still expose sensitive information.</p>

<p>How? Via the name of the bucket.</p>

<p>I once had a client that had created a bucket for everyone of their customers and
thereby leaked their customer list. Granted, this is not the most serious issue in
the cloud, but let’s take a look and you may learn more about AWS S3 in the process.</p>

<p>Imagine, for a moment, we are a company called “ACME Manufacturing.” I always like to
use ACME from the Road Runner cartoons that played on Saturday morning television when
I was a kid.</p>

<p>Let’s also imagine that we plan to create a bucket for each of our customers. And, let’s
say that Walmart is our first customer. So, let’s make a bucket for Walmart:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ aws s3 mb s3://acme-customers-walmart
make_bucket: acme-customers-walmart
</code></pre></div></div>

<p>Now upload some sensitive information to the bucket:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ echo "Juicy Sensitive Data" &gt; customerData.txt
$ aws s3 cp  customerData.txt s3://acme-customers-walmart/customerData.txt
upload: ./customerData.txt to s3://acme-customers-walmart/customerData.txt
</code></pre></div></div>

<p>In the AWS Web Console, we can see that the URL do our data is:
https://acme-customers-walmart.s3.amazonaws.com/customerData.txt</p>

<p><img src="/images/ep2/Picture1.png" alt="Image of the AWS S3 Console showing bucket metadata" /></p>

<p>Next attempt to open the link in a new browser window. I like to use Incognito mode in
Chrome so that I am sure that there is no session data in memory to authenticate me to
the AWS endpoint.</p>

<p>We should get an XML message stating that access is denied:</p>

<p><img src="/images/ep2/Picture2.png" alt="Image of the access denied error message" /></p>

<p>Ok, that is expected. It is not a public bucket after all. Let’s change the name of the
file we are trying to fetch to “customerData2.txt”</p>

<p><img src="/images/ep2/Picture3.png" alt="Image of the access denied error message" /></p>

<p>Still Denied. Ok, lets play at the bucket level, by removing the file name from the URL:</p>

<p><img src="/images/ep2/Picture4.png" alt="Image of the access denied error message" /></p>

<p>Access denied, as expected. One more experiment. Try a non-existent bucket, such as
“<strong>acme-customers-kmart</strong>”</p>

<p><img src="/images/ep2/Picture5.png" alt="Image of the no such bucket error message" /></p>

<p>Interesting. Now we are getting a different error message.</p>

<p>This is a variation of a user account enumeration attack. (For more information,
see <a href="http://bit.ly/OWASP-4-03-04">http://bit.ly/OWASP-4-03-04</a>)</p>

<p>Because we can get different error messages, we now might have a means to enumerate the
buckets for customer names.</p>

<p>Rather than using a browser, let’s use curl:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl -i https://acme-customers-walmart.s3.amazonaws.com/
curl -i https://acme-customers-kmart.s3.amazonaws.com/
</code></pre></div></div>

<p><img src="/images/ep2/Picture6.png" alt="Image of the output of the previous commands" /></p>

<p>Note that the HTTP response codes are also different.</p>

<p>We can tweak our command to just return the HTTP Response code:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl -I -s  https://acme-customers-walmart.s3.amazonaws.com/ | grep HTTP
</code></pre></div></div>

<p><img src="/images/ep2/Picture7.png" alt="Image of the output of the previous command" /></p>

<p>We can even parameterize the customer name and create a FOR loop:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>for NAME in kmart walgreens walmart aldi
do
    RESPONSE=$(curl -I -s  https://acme-customers-$NAME.s3.amazonaws.com/ | grep HTTP)
    echo $NAME": "$RESPONSE
done
</code></pre></div></div>

<p><img src="/images/ep2/Picture8.png" alt="Image of the output of the previous command" /></p>

<p>Interesting! We can see the expected response codes for Kmart and Walmart. But it
looks like ACME made their Walgreens bucket public!!</p>

<p>What is going on with the <strong>acme-customers-aldi</strong> bucket?</p>

<p>Let’s run the curl command again and fetch the complete response:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl -i https://acme-customers-aldi.s3.amazonaws.com/
</code></pre></div></div>

<p><img src="/images/ep2/Picture9.png" alt="Image of the output of the previous command" /></p>

<p>That is nice of Amazon. Not only do we know that the bucket exists, but that it is hosted in the Frankfurt, Germany region (eu-central-1) because it uses the S3 endpoint at <strong>s3.eu-central-1.amazonaws.com</strong> rather than Northern Virginia, which uses <strong>s3.amazonaws.com</strong>. More potentially useful recon info.</p>

<h2 id="acknowledgements">Acknowledgements</h2>

<p>Today’s topic builds upon the work of Robin Woods (“DigiNija”) and his <a href="https://digi.ninja/projects/bucket_finder.php">Bucket Finder</a> tool. There have been other bucket scanning tools, but for today’s topic, I wanted to make sure people understand how these tools work under the covers.</p>

<h2 id="important-take-aways">Important Take-Aways</h2>
<ol>
  <li>It is generally unwise to have guessable bucket names. For example, a bucket name of acme-customers-walmart-282901034857378292 would be better, as long as the numerical string appended to the end is random and not something like your AWS account number.</li>
  <li>It would be better to avoid using meaningful words and names such as “ACME”, “Walmart” or even “customers” for bucket names. Remember that you can always use tags and tags are not exposed via DNS. Nothing wrong with a bucket named “cx2821023238238” assuming it is unique.</li>
  <li>If you want to have meaningful names and phrases, do that at the folder level inside a bucket as folders are not exposed by default (like bucket names are).</li>
  <li>Lastly, remember that just because there is a bucket name that contains the name of a well-known company, doesn’t mean that that bucket is controlled by that company. In the examples used in today’s talk, I created buckets for a couple of top retailers even though I have no affiliation with them.</li>
</ol>

<h2 id="wrap-up">Wrap Up</h2>

<p>And that is it for today’s episode.</p>

<p>If you have thoughts or comments on today’s episode, feel free to chime in on our moderated Google Group by shooting a note to <a href="mailto://head-in-the-clouds-security@googlegroups.com">head-in-the-clouds-security@googlegroups.com</a>.</p>

<p>Tune in next time for another installment of “Head in the Clouds.” Announcements of new episodes are made on the <a href="https://twitter.com/SANSCloudSec">SANS Cloud Security Twitter feed</a>.</p>

<p>Meanwhile, be sure to check out the other great videos on the <a href="https://www.youtube.com/c/SANSCloudSecurity">SANS Cloud Security YouTube Channel</a>.</p>

      
        <hr />
        <div class="social-share">
  <!--<h4>Share on</h4>
  <ul>
    <li>
      <a href="https://twitter.com/intent/tweet?text=/episodes/episode02/" class="twitter" title="Share on Twitter"><i class="fa fa-twitter"></i><span> Twitter</span></a>
    </li>
    <li>
      <a href="https://www.facebook.com/sharer/sharer.php?u=/episodes/episode02/" class="facebook" title="Share on Facebook"><i class="fa fa-facebook"></i><span> Facebook</span></a>
    </li>
    <li>
      <a href="https://plus.google.com/share?url=/episodes/episode02/" class="google-plus" title="Share on Google Plus"><i class="fa fa-google-plus"></i><span> Google+</span></a>
    </li>
  </ul>-->
</div><!-- /.social-share -->

      
    </div><!-- /.article-wrap -->
    
  </article>
</div><!-- /#index -->

<div class="footer-wrap">
  <footer>
    

<span>&copy; 2022 Head in the Clouds.<br /></span>


  </footer>
</div><!-- /.footer-wrap -->

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="/assets/js/vendor/jquery-1.9.1.min.js"><\/script>')</script>
<script src="/assets/js/scripts.min.js"></script>

<!-- Asynchronous Google Analytics snippet -->
<script>
  var _gaq = _gaq || [];
  var pluginUrl =
 '//www.google-analytics.com/plugins/ga/inpage_linkid.js';
  _gaq.push(['_require', 'inpage_linkid', pluginUrl]);
  _gaq.push(['_setAccount', 'UA-25220220-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'https://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>




</body>
</html>
